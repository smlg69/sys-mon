// api/requests.ts
import { apiClient } from './client';

export interface Order {
  id: string | number;
  date?: string;
  description?: string;
  type?: string;
  device?: string;
  user?: string;
  status?: string;
  originalData?: any;
  [key: string]: any;
}

export interface User {
  id: string | number;
  name: string;
  username?: string;
  role?: string;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è windows-1251
const decodeWindows1251 = (text: any): string => {
  if (text === null || text === undefined) return '';
  if (typeof text !== 'string') return String(text);
  
  // –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —É–∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
  if (!text.includes('ÔøΩ') && /^[\x00-\x7F]*$/.test(text)) {
    return text;
  }
  
  try {
    // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –±–∞–π—Ç–æ–≤
    const bytes = new Uint8Array(text.length);
    for (let i = 0; i < text.length; i++) {
      bytes[i] = text.charCodeAt(i) & 0xFF;
    }
    
    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∫–∞–∫ windows-1251
    const decoder = new TextDecoder('windows-1251');
    return decoder.decode(bytes);
  } catch (error) {
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç:', text.substring(0, 50));
    return text;
  }
};

export const requestsApi = {
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ —Å –±—ç–∫–∞ (—Å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
  getOrders: async (): Promise<Order[]> => {
    try {
      console.log('üîÑ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫...');
      
      // –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
      const response = await apiClient.postWithDecoding('/getOrdersF', [], 'windows-1251');
      
      console.log('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:', response.length);
      
      if (response.length > 0) {
        console.log('üìã –ü—Ä–∏–º–µ—Ä –∑–∞—è–≤–∫–∏ (–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ):', response[0]);
        console.log('üîë –ö–ª—é—á–∏ –ø–µ—Ä–≤–æ–π –∑–∞—è–≤–∫–∏:', Object.keys(response[0]));
      }
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Å–µ –∑–∞—è–≤–∫–∏
      const formattedOrders = response.map((order: any, index: number) => {
        const formattedOrder: Order = {
          id: order.id || `order_${index}`,
          date: order.date || '',
          description: order.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è',
          type: order.type || '–ù–µ —É–∫–∞–∑–∞–Ω',
          device: order.device || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
          user: order.user || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω',
          status: mapStatus(order.status) || '–°–æ–∑–¥–∞–Ω–∞',
          originalData: order,
        };
        
        // –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
        Object.keys(order).forEach(key => {
          if (!(key in formattedOrder)) {
            formattedOrder[key] = order[key];
          }
        });
        
        return formattedOrder;
      });
      
      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Ç–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
      const statusStats = formattedOrders.reduce((acc: Record<string, number>, order: Order) => {
        const status = order.status || 'unknown';
        acc[status] = (acc[status] || 0) + 1;
        return acc;
      }, {});
      
      console.log('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º:', statusStats);
      console.log('üìä –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫:', formattedOrders.length);
      
      return formattedOrders;
      
    } catch (error: any) {
      console.error('‚ùå –°–ø–æ—Å–æ–± 1 –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º —Å–ø–æ—Å–æ–± 2...', error);
      
      try {
        // –°–ø–æ—Å–æ–± 2: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ä—É—á–Ω—ã–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        const response = await apiClient.post<any[]>('/getOrdersF', []);
        
        // –†—É—á–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
        const decodedOrders = response.map((order: any) => {
          const decoded: any = {};
          Object.keys(order).forEach(key => {
            decoded[key] = decodeWindows1251(order[key]);
          });
          return decoded;
        });
        
        console.log('‚úÖ –°–ø–æ—Å–æ–± 2 —É—Å–ø–µ—à–µ–Ω, –∑–∞—è–≤–æ–∫:', decodedOrders.length);
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏
        const formattedOrders = decodedOrders.map((order: any, index: number) => {
          const formattedOrder: Order = {
            id: order.id || `order_${index}`,
            date: order.date || '',
            description: order.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è',
            type: order.type || '–ù–µ —É–∫–∞–∑–∞–Ω',
            device: order.device || '–ù–µ —É–∫–∞–∑–∞–Ω–æ',
            user: order.user || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω',
            status: mapStatus(order.status) || '–°–æ–∑–¥–∞–Ω–∞',
            originalData: order,
          };
          
          Object.keys(order).forEach(key => {
            if (!(key in formattedOrder)) {
              formattedOrder[key] = order[key];
            }
          });
          
          return formattedOrder;
        });
        
        return formattedOrders;
        
      } catch (error2: any) {
        console.error('‚ùå –û–±–∞ —Å–ø–æ—Å–æ–±–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏:', error2);
        console.error('üìÑ –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error2.response?.data || error2.message);
        
        return getMockOrders();
      }
    }
  },
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏
  updateOrderStatus: async (orderId: string | number, status: string): Promise<any> => {
  try {
    console.log(`üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ ${orderId} –Ω–∞ "${status}"`);
    
    const dataToSend = {
      id: orderId.toString(),
      status: status,
      // nUser: existingUser // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    };
    
    return await apiClient.postWithDecoding(
      'updateOrderF', // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç
      [dataToSend],
      'windows-1251'
    );
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
    throw error;
  }
},
  // –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ (–î–û–ë–ê–í–¨–¢–ï –≠–¢–û–¢ –ú–ï–¢–û–î)
  updateOrder: async (orderId: string | number, updateData: {
    status?: string;
    user?: string;
    description?: string;
    priority?: string;
    [key: string]: any;
  }): Promise<any> => {
    try {
      console.log(`üîÑ –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ ${orderId}:`, updateData);
      
       // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    const dataToSend: any = {
      id: orderId.toString(), // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
    };
    
    // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ —Ç–æ, —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä
    if (updateData.status) dataToSend.status = updateData.status;
    if (updateData.user) dataToSend.nUser = updateData.user; // user -> nUser
    if (updateData.description) dataToSend.description = updateData.description;
    if (updateData.priority) dataToSend.priority = updateData.priority;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
    Object.keys(updateData).forEach(key => {
      if (!['status', 'user', 'description', 'priority'].includes(key)) {
        dataToSend[key] = updateData[key];
      }
    });
    
    console.log('üì§ –î–∞–Ω–Ω—ã–µ –¥–ª—è updateOrderF:', dataToSend);
      
      return await apiClient.postWithDecoding(
        '/updateOrderF',
        [dataToSend],
        'windows-1251'
      );
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏:', error);
      throw error;
    }
  },
  
  
  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
  createOrder: async (orderData: Partial<Order>): Promise<any> => {
    try {
      console.log('üÜï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞):', orderData);
      
      // –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–±—É–µ–º —Å–Ω–∞—á–∞–ª–∞ –æ–±—ã—á–Ω—ã–π POST
      try {
        const response = await apiClient.post('setNewOrderF', [orderData]);
        console.log('‚úÖ –û–±—ã—á–Ω—ã–π POST —É—Å–ø–µ—à–µ–Ω:', response);
        return response;
      } catch (error1) {
        console.log('‚ùå –û–±—ã—á–Ω—ã–π POST –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º —Å –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º...');
        
        // –í–∞—Ä–∏–∞–Ω—Ç 2: –° –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        const decodedResponse = await apiClient.postWithDecoding(
          'setNewOrderF', 
          [orderData], 
          'windows-1251'
        );
        console.log('‚úÖ –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç:', decodedResponse);
        return decodedResponse;
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏:', error);
      throw error;
    }
  },
  
  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
  getUsers: async (): Promise<User[]> => {
    try {
      console.log('üîÑ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
      
      // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –±—ç–∫–∞
      const response = await apiClient.postWithDecoding('/getUsersF', [], 'windows-1251');
      
      const users: User[] = response.map((user: any) => ({
        id: user.id || user.user_id || user.name,
        name: decodeWindows1251(user.name || user.full_name || user.username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'),
        username: user.username,
        role: user.role,
      }));
      
      console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', users.length);
      return users;
      
    } catch (error) {
      console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å–µ—Ä–≤–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫');
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
      return [
        { id: 1, name: '–í–∞—Å–∏–ª—å–µ–≤ –ú.–°.' },
        { id: 2, name: '–°–º–∏—Ä–Ω–æ–≤ –ê.–ü.' },
        { id: 3, name: '–ò–≤–∞–Ω–æ–≤ –ü.–ö.' },
        { id: 4, name: '–ü–æ–ø–æ–≤ –î.–í.' },
        { id: 5, name: '–°–∏–¥–æ—Ä–æ–≤ –ò.–ò.' },
        { id: 6, name: '–ú–∞—Ö–º—É–¥–æ–≤ –ò.–ö.' },
        { id: 7, name: '–ü–µ—Ç—Ä–æ–≤ –í.–ê.' },
        { id: 8, name: '–ù–∏–∫–æ–ª–∞–µ–≤ –°.–ò.' },
      ];
    }
  },
  
  // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é (–û–°–¢–ê–í–¨–¢–ï –¢–û–õ–¨–ö–û –û–î–ò–ù –≠–¢–û–¢ –ú–ï–¢–û–î!)
  // api/requests.ts - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π assignOrder
// api/requests.ts - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π assignOrder
assignOrder: async (orderId: string | number, userId: string, userName: string): Promise<any> => {
  try {
    console.log(`üîÑ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏ ${orderId} –Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è ${userName} (ID: ${userId})`);
    
    // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç!)
    const dataToSend = {
      id: orderId.toString(),
      nUser: userName,
      // –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º status - —Å–µ—Ä–≤–µ—Ä —Å–∞–º –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏
      // status: '–í —Ä–∞–±–æ—Ç–µ', // –£–ë–†–ê–¢–¨ —ç—Ç—É —Å—Ç—Ä–æ–∫—É!
    };
    
    console.log('üì§ –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ updateOrderF:', dataToSend);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    const response = await apiClient.postWithDecoding(
      'updateOrderF',
      [dataToSend], // –ú–∞—Å—Å–∏–≤ —Å –æ–¥–Ω–∏–º –æ–±—ä–µ–∫—Ç–æ–º
      'windows-1251'
    );
    
    console.log('‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞:', response);
    return response;
    
  } catch (error: any) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏:', error);
    throw error;
  }
},

// api/requests.ts - –¥–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤ –æ–±—ä–µ–∫—Ç requestsApi –ø–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–æ–π
testUpdateFormat: async (orderId: string | number, userName: string): Promise<any> => {
  console.log(`üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–ª—è –∑–∞—è–≤–∫–∏ ${orderId}`);
  
  const formats = [
    // –§–æ—Ä–º–∞—Ç 1: –ú–∞—Å—Å–∏–≤ —Å –æ–¥–Ω–∏–º –æ–±—ä–µ–∫—Ç–æ–º (—Ç–µ–∫—É—â–∏–π)
    { data: [{ id: orderId.toString(), status: '–í —Ä–∞–±–æ—Ç–µ', nUser: userName }], name: '–ú–∞—Å—Å–∏–≤ —Å nUser' },
    // –§–æ—Ä–º–∞—Ç 2: –ü—Ä–æ—Å—Ç–æ –æ–±—ä–µ–∫—Ç
    { data: { id: orderId.toString(), status: '–í —Ä–∞–±–æ—Ç–µ', nUser: userName }, name: '–û–±—ä–µ–∫—Ç —Å nUser' },
    // –§–æ—Ä–º–∞—Ç 3: –° user –≤–º–µ—Å—Ç–æ nUser
    { data: [{ id: orderId.toString(), status: '–í —Ä–∞–±–æ—Ç–µ', user: userName }], name: '–ú–∞—Å—Å–∏–≤ —Å user' },
    // –§–æ—Ä–º–∞—Ç 4: –° —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
    { data: [{ id: orderId.toString(), status: '–≤ —Ä–∞–±–æ—Ç–µ', nUser: userName }], name: '–°—Ç–∞—Ç—É—Å –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä' },
    // –§–æ—Ä–º–∞—Ç 5: –° –∞–Ω–≥–ª–∏–π—Å–∫–∏–º —Å—Ç–∞—Ç—É—Å–æ–º
    { data: [{ id: orderId.toString(), status: 'in_progress', nUser: userName }], name: '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —Å—Ç–∞—Ç—É—Å' },
    // –§–æ—Ä–º–∞—Ç 6: –ë–µ–∑ —Å—Ç–∞—Ç—É—Å–∞, —Ç–æ–ª—å–∫–æ nUser
    { data: [{ id: orderId.toString(), nUser: userName }], name: '–¢–æ–ª—å–∫–æ nUser' },
    // –§–æ—Ä–º–∞—Ç 7: –° –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏
    { data: [{ 
      id: orderId.toString(), 
      status: '–í —Ä–∞–±–æ—Ç–µ', 
      nUser: userName,
      action: 'assign',
      timestamp: new Date().toISOString()
    }], name: '–° –¥–æ–ø –ø–æ–ª—è–º–∏' },
  ];
  
  for (const format of formats) {
    try {
      console.log(`\nüîÑ –ü—Ä–æ–±—É–µ–º —Ñ–æ—Ä–º–∞—Ç: ${format.name}`);
      console.log('üì§ –î–∞–Ω–Ω—ã–µ:', format.data);
      
      const response = await apiClient.postWithDecoding(
        'updateOrderF',
        format.data,
        'windows-1251'
      );
      
      console.log(`‚úÖ –§–æ—Ä–º–∞—Ç ${format.name} —É—Å–ø–µ—à–µ–Ω:`, response);
      return { success: true, format: format.name, response };
    } catch (error: any) {
      console.log(`‚ùå –§–æ—Ä–º–∞—Ç ${format.name} –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:`, error.message);
    }
  }
  
  throw new Error('–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏');
}

  
};

// –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤
const mapStatus = (status?: string): string => {
  if (!status) return '–°–æ–∑–¥–∞–Ω–∞';
  
  const statusMap: Record<string, string> = {
    // –ö–∏—Ä–∏–ª–ª–∏—Ü–∞
    '—Å–æ–∑–¥–∞–Ω–∞': '–°–æ–∑–¥–∞–Ω–∞',
    '–≤ —Ä–∞–±–æ—Ç–µ': '–í —Ä–∞–±–æ—Ç–µ',
    '–∑–∞–≤–µ—Ä—à–µ–Ω–∞': '–ó–∞–≤–µ—Ä—à–µ–Ω–∞',
    '–∑–∞–∫—Ä—ã—Ç–∞': '–ó–∞–∫—Ä—ã—Ç–∞',
    '–æ—Ç–º–µ–Ω–µ–Ω–∞': '–û—Ç–º–µ–Ω–µ–Ω–∞',
    // –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –∞–Ω–∞–ª–æ–≥–∏
    'created': '–°–æ–∑–¥–∞–Ω–∞',
    'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
    'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–∞',
    'closed': '–ó–∞–∫—Ä—ã—Ç–∞',
    'cancelled': '–û—Ç–º–µ–Ω–µ–Ω–∞',
  };
  
  const lowerStatus = status.toLowerCase().trim();
  return statusMap[lowerStatus] || status;
};

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞)
const getMockOrders = (): Order[] => {
  console.log('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
  
  return [
    { 
      id: '#00001', 
      date: '2025-12-20 10:02:01', 
      description: '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç', 
      type: '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ', 
      device: '–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ—Å—Ç—É–ø–∞ ‚Ññ3', 
      user: '–ò–≤–∞–Ω–æ–≤ –ò.–ò.', 
      status: '–°–æ–∑–¥–∞–Ω–∞',
    },
    { 
      id: '#00002', 
      date: '2025-12-20 10:03:01', 
      description: '–ó–∞–º–µ–Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è', 
      type: '–ó–∞–º–µ–Ω–∞', 
      device: '–î–∞—Ç—á–∏–∫ ‚Ññ5', 
      user: '–ü–µ—Ç—Ä–æ–≤ –ü.–ü.', 
      status: '–í —Ä–∞–±–æ—Ç–µ',
    },
    { 
      id: '#00003', 
      date: '2025-12-20 10:04:01', 
      description: '–†–µ–º–æ–Ω—Ç –Ω–∞—Å–æ—Å–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏', 
      type: '–†–µ–º–æ–Ω—Ç', 
      device: '–ù–∞—Å–æ—Å–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è ‚Ññ1', 
      user: '–°–∏–¥–æ—Ä–æ–≤ –°.–°.', 
      status: '–ó–∞–≤–µ—Ä—à–µ–Ω–∞',
    },
  ];
};